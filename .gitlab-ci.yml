# The docker image to run this CI pipeline in.
image: "binaryanalysisplatform/bap:latest"

# Run the tests
run_tests:

  tags: 
    - docker # Tag this so docker CI runners pick it up.

  script:

    # Install APT dependencies.
    - >-
      sudo -E apt install -y
      qemu gcc-arm-linux-gnueabi binutils-arm-linux-gnueabi cmake

    # Install other dependencies (non-sudo).
    - bash -x bin/setup/install-dependencies.bash --report-results

    # Build and install the VIBES tool.
    - source bin/setup/env.bash
    - make

    # Run unit and integration tests.
    - bash -x bin/unit-tests/run-tests.bash --report-results
    - bash -x bin/integration-tests/run-tests.bash --report-results

    # Run system tests.
    - make
    - bash -x bin/system-tests/run-tests.bash --report-results

    - echo "Done"
